DATA SEGMENT
INPUTNAME DB 'Please input the name: $'
INPUTNUM DB 'Please input phone number: $'
QUERY DB 'Please input the name you want to search: $'
ANSWER DB ' phone number is :$'
ERRORS DB 'ERROR$'
LINE DB 0DH,0AH,'$'
NUM DB 00H
OVER DB '$'
SEARCH DB 11 DUP(0)
USER DB 110 DUP(0)
PHONE DB 110 DUP(0)
AI DB 'If you want to add,press 1',0DH,0AH,'If you want to search,press2',0DH,0AH,'$'
DATA ENDS
STACK SEGMENT
STACK ENDS
CODE SEGMENT
ASSUME CS:CODE,DS:DATA,SS:STACK
START:
MOV AX,DATA
MOV DS,AX
CALL INPUT
CALL PAIXU
CALL PRINT
AGAIN6:
CALL SELECT
JMP AGAIN6
MOV AH,4CH
INT 21H
SELECT:
PUSH AX
PUSH BX
PUSH CX
PUSH DX
MOV DX,OFFSET LINE
MOV AH,09H
INT 21H
MOV DX,OFFSET AI
MOV AH,09H
INT 21H
MOV AH,01H
INT 21H
CMP AL,31H
JZ SHURU
CMP AL,32H
JZ CHAXUN
JMP OUV
SHURU:
CALL PUT123
CALL PAIXU
CALL PRINT
JMP OUV
CHAXUN:
CALL INPUTQUERY
JMP OUV
OUV:
MOV DX,OFFSET LINE
MOV AH,09H
INT 21H
POP DX
POP CX
POP BX
POP AX
RET
PUT123:
PUSH AX
PUSH BX
PUSH CX
PUSH DX
PUSH SI
MOV BX,OFFSET NUM
MOV AL,BYTE PTR[BX]
MOV AH,00H
MOV CL,0BH
MUL CL
MOV SI,AX
MOV DX,OFFSET INPUTNAME
MOV AH,09H
INT 21H
PUSH SI
MOV BX,OFFSET USER
PUTNAME:
MOV AH,01H
INT 21H
MOV BYTE PTR[BX][SI],AL
INC SI
CMP AL,0DH
JNZ PUTNAME
DEC SI
MOV BYTE PTR[BX][SI],'$'
POP SI
MOV DX,OFFSET INPUTNUM
MOV AH,09H
INT 21H
MOV BX,OFFSET PHONE
PUTPHONE:
MOV AH,01H
INT 21H
MOV BYTE PTR[BX][SI],AL
INC SI
CMP AL,0DH
JNZ PUTPHONE
DEC SI
MOV BYTE PTR[BX][SI],'$'
MOV BX,OFFSET NUM
MOV AL,BYTE PTR[BX]
INC AL
MOV BYTE PTR[BX],AL
POP SI
POP DX
POP CX
POP BX
POP AX
RET
PAIXU:
PUSH AX
PUSH BX
PUSH CX
PUSH DX
MOV BX,OFFSET NUM
MOV CL,BYTE PTR[BX]
MOV CH,00H
MOV BX,OFFSET USER
AGAIN7:
PUSH CX
DEC CX
CMP CL,00H
JZ NOAGAIN
MOV SI,0000H
AGAIN8:
MOV AH,BYTE PTR [BX][SI]
MOV AL,BYTE PTR 0BH[BX][SI]
CMP AH,AL
JNC EXCHANGE
NOEXCHANGE:
ADD SI,0BH
LOOP AGAIN8
NOAGAIN:
POP CX
LOOP AGAIN7
JMP ENDDD
EXCHANGE:
PUSH BX
PUSH CX
PUSH SI
PUSH AX
PUSH DI
;;;;;;;交换 SI 和 SI+0BH
MOV CX,0000H
MOV CL,0BH
MOV DI,SI
ADD DI,000BH
AGAIN9:
MOV AH,BYTE PTR[BX][SI]
MOV AL,BYTE PTR[BX][DI]
MOV BYTE PTR[BX][SI],AL
MOV BYTE PTR[BX][DI],AH
PUSH BX
MOV BX,OFFSET PHONE
MOV AH,BYTE PTR[BX][SI]
MOV AL,BYTE PTR[BX][DI]
MOV BYTE PTR[BX][SI],AL
MOV BYTE PTR[BX][DI],AH
POP BX
INC SI
INC DI
LOOP AGAIN9
POP DI
POP AX
POP SI
POP CX
POP BX
JMP NOEXCHANGE
ENDDD:
POP DX
POP CX
POP BX
POP AX
RET
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;
PRINT:
PUSH AX
PUSH BX
PUSH CX
PUSH DX
MOV BX,OFFSET NUM
MOV CL,BYTE PTR[BX]
MOV CH,00H
MOV SI,0000H
MOV DX,OFFSET LINE
MOV AH,09H
INT 21H
AGAIN3:
MOV BX,OFFSET USER
ADD BX,SI
MOV DX,BX
MOV AH,09H
INT 21H
MOV DL,' '
MOV AH,02H
INT 21H
INT 21H
INT 21H
MOV BX,OFFSET PHONE
ADD BX,SI
MOV DX,BX
MOV AH,09H
INT 21H
MOV DX,OFFSET LINE
MOV AH,09H
INT 21H
ADD SI,000BH
LOOP AGAIN3
POP DX
POP CX
POP BX
POP AX
RET
INPUTQUERY:
PUSH AX
PUSH BX
PUSH CX
PUSH DX
MOV DX,OFFSET QUERY
MOV AH,09H
INT 21H
MOV BX,OFFSET SEARCH
MOV SI,0000H
PUT:
MOV AH,01H
INT 21H
CMP AL,0DH
JZ COM
MOV BYTE PTR[BX][SI],AL
INC SI
JMP PUT
COM:
MOV BYTE PTR[BX][SI],'$'
MOV DX,OFFSET LINE
MOV AH,09H
INT 21H;;查询的输入程序
;;目前为止 SI 当中保存的输入的字符的个数+1
SUB SI,01H
MOV CX,SI
MOV SI,0000H
MOV BX,OFFSET NUM
MOV DL,BYTE PTR[BX];电话本中的人的个数
MOV DH,00H

MOV CH,00H
MOV CL,00H
MOV DI,0000H
AGAIN4:
MOV BX,OFFSET USER
MOV AH,BYTE PTR [BX][SI];AH 当中保存的是用户
MOV BX,OFFSET SEARCH
MOV AL,BYTE PTR DS:[BX][DI];AL 当中保存的是所查询的人的姓名
CMP AH,AL
JZ EQUAL
JMP UNEQUAL
EQUAL:
INC SI
INC DI
CMP AH,'$'
JNZ AGAIN4
JMP PRINTPHONE
UNEQUAL:
MOV DI,0000H
DEC DL
INC CL
PUSH CX
MOV SI,0000H
AGAIN5:
ADD SI,0BH
LOOP AGAIN5
POP CX
CMP DL,00H
JNZ AGAIN4
JMP FAIL
PRINTPHONE:
PUSH DX
MOV DX,OFFSET SEARCH
MOV AH,09H
INT 21H
MOV DX,OFFSET ANSWER
MOV AH,09H
INT 21H
POP DX
MOV BX,OFFSET NUM
MOV DH,BYTE PTR[BX]

SUB DH,DL
;;DH 是要输出的
MOV BX,OFFSET PHONE
MOV AX,0000H
MOV AL,DH
MOV CL,0BH
MUL CL
ADD BX,AX
MOV DX,BX
MOV AH,09H
INT 21H
JMP ENDD
FAIL:
MOV DX,OFFSET ERRORS
MOV AH,09H
INT 21H
ENDD:
MOV DX,OFFSET LINE
MOV AH,09H
INT 21H
POP DX
POP CX
POP BX
POP AX
RET
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;
INPUT:
PUSH AX
PUSH BX
PUSH CX
PUSH DX
MOV SI,0000H
MOV BX,OFFSET USER
MOV CX,0000H;CH 用来存人的个数 用来存目前字符的个数
AGAIN:

MOV DX,OFFSET INPUTNAME
MOV AH,09H
INT 21H
AGAIN1:
MOV AH,01H
INT 21H
CMP AL,0DH
JZ COMPLETE
PUSH SI
PUSH CX
MOV CH,00H
ADD SI,CX
POP CX
MOV BYTE PTR [BX][SI],AL
POP SI
INC CL
JMP AGAIN1
COMPLETE:
CMP CL,00H
JZ ENDD1
;输入电话号码:
PUSH AX
PUSH BX
PUSH CX
PUSH DX
MOV DX,OFFSET LINE
MOV AH,09H
INT 21H
MOV DX,OFFSET INPUTNUM
INT 21H
MOV CL,00H
MOV BX,OFFSET PHONE
AGAIN2:
MOV AH,01H
INT 21H
CMP AL,0DH
JZ PHONEOVER
PUSH SI
PUSH CX
MOV CH,00H
ADD SI,CX
POP CX

MOV BYTE PTR [BX][SI],AL
POP SI
INC CL
JMP AGAIN2
PHONEOVER:
PUSH SI
PUSH CX
MOV CH,00H
ADD SI,CX
MOV BYTE PTR [BX][SI],'$'
POP CX
POP SI
POP DX
POP CX
POP BX
POP AX
INC CH
PUSH SI
PUSH CX
MOV CH,00H
ADD SI,CX
MOV BYTE PTR [BX][SI],'$'
POP CX
POP SI
ADD SI,0BH;最多存放的字符
MOV DX,OFFSET LINE
MOV AH,09H
INT 21H
MOV CL,00H
JMP AGAIN
ENDD1:
MOV BX,OFFSET NUM
MOV BYTE PTR[BX],CH
POP DX
POP CX
POP BX
POP AX
RET
CODE ENDS
END START